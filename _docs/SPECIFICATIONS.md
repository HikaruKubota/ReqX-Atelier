# ReqX-Atelier 仕様書

## 1. プロジェクト概要

**ReqX-Atelier** は、Electron + React + TypeScript で構築されたデスクトップAPIテストクライアントです。Postmanや Insomnia の代替として、シンプルで使いやすいAPIリクエスト環境を提供します。

### 技術スタック

- **フロントエンド**: React 19.1.0 + TypeScript 5.8.3
- **デスクトップフレームワーク**: Electron 36.2.0
- **ビルドツール**: Vite 6.3.5
- **状態管理**: Zustand 5.0.4
- **UI/CSS**: Tailwind CSS 3.4.17
- **テスト**: Vitest 3.1.3 + React Testing Library + Playwright
- **コンポーネント開発**: Storybook 8.6.14
- **HTTPクライアント**: Axios 1.9.0
- **ドラッグ&ドロップ**: @dnd-kit/core 6.3.1
- **国際化**: i18next 25.1.3 + react-i18next 15.5.1

### システム要件

- **Node.js**: 20以上
- **NPM**: v10以上推奨

---

## 2. アーキテクチャ

### 2.1 プロセス構成

#### メインプロセス (`main.js`)

- **役割**: ElectronのメインプロセスとしてアプリケーションのライフサイクルとIPCを管理
- **HTTP通信**: AxiosによるAPIリクエスト実行（CORS回避のため）
- **IPCハンドラー**: `send-api-request`チャンネルでAPIリクエストを受信・実行
- **セキュリティ設定**:
  - `contextIsolation: false`
  - `webSecurity: false`
  - `nodeIntegration: true`

#### レンダラープロセス (`src/renderer/`)

- **役割**: Reactアプリケーション本体
- **API通信**: IPCを介してメインプロセスにリクエストを委譲
- **UIレンダリング**: コンポーネントベースのUI構築

### 2.2 ディレクトリ構成

```
src/renderer/src/
├── components/
│   ├── atoms/          # 基本UIエレメント（ボタン、フォーム要素など）
│   ├── molecules/      # 複合コンポーネント（行、アラートなど）
│   ├── organisms/      # 複雑なコンポーネント（タブバー、ガイドなど）
│   └── *.tsx          # ページレベルコンポーネント
├── hooks/             # カスタムフック
├── store/             # Zustand状態管理
├── theme/             # テーマとカラー定義
├── types/             # TypeScript型定義
├── locales/           # 国際化リソース
└── main.tsx           # アプリケーションエントリポイント
```

---

## 3. 主要機能

### 3.1 APIリクエスト機能

#### HTTPメソッド対応

- GET、POST、PUT、DELETE、PATCHなど全メソッド対応
- カスタムHTTPメソッドも入力可能

#### リクエスト設定

- **URL**: クエリパラメータの自動統合
- **ヘッダー**: Key-Valueペアでの設定、有効/無効切り替え
- **ボディ**: Key-ValueペアまたはJSON形式で入力
- **パラメータ**: URLクエリパラメータとして自動付与

#### レスポンス表示

- **データ**: JSON形式での整形表示
- **ヘッダー**: レスポンスヘッダーの表示
- **ステータス**: HTTPステータスコードと説明
- **レスポンス時間**: リクエスト実行時間の計測
- **コピー機能**: レスポンス内容をクリップボードにコピー

### 3.2 リクエストコレクション管理

#### 階層構造

- **フォルダー**: 無制限の階層フォルダー作成
- **リクエスト**: フォルダー内でのリクエスト整理
- **ドラッグ&ドロップ**: リクエストとフォルダーの移動

#### CRUD操作

- **作成**: 新規リクエスト・フォルダーの追加
- **読み込み**: 保存済みリクエストの読み込み
- **更新**: リクエスト内容の変更・保存
- **削除**: リクエスト・フォルダーの削除（再帰的削除対応）
- **複製**: リクエスト・フォルダーのコピー機能

#### 永続化

- **LocalStorage**: ブラウザのLocalStorageに自動保存
- **マイグレーション**: 古いデータ形式からの自動変換

### 3.3 タブ管理

#### マルチタブ機能

- **複数タブ**: 同時に複数のリクエストを編集可能
- **タブ切り替え**: クリックまたはキーボードショートカットで切り替え
- **タブ並び替え**: ドラッグ&ドロップでタブの順序変更
- **タブ閉じる**: 個別または一括でタブを閉じる

#### タブ状態管理

- **リクエスト関連付け**: 保存済みリクエストとタブの関連付け
- **レスポンス保持**: タブごとにレスポンス履歴を保持
- **新規タブ**: 空の新規リクエストタブの作成

### 3.4 テーマ機能

#### ダーク/ライトモード

- **切り替え**: ワンクリックでのテーマ切り替え
- **永続化**: 選択したテーマをLocalStorageに保存
- **CSS Variables**: CSS変数を使用した動的なカラー切り替え
- **Tailwind統合**: Tailwind CSSのダークモードクラス戦略

#### カラーパレット

- **ライトモード**: 白ベース（#ffffff）のクリーンなデザイン
- **ダークモード**: グレー系（#1f2937）の目に優しいデザイン

### 3.5 国際化（i18n）

#### 対応言語

- **日本語**: デフォルト言語
- **英語**: フォールバック言語

#### 翻訳対象

- UI要素のテキスト
- エラーメッセージ
- 確認ダイアログ
- トースト通知

---

## 4. 状態管理

### 4.1 Zustand Store

#### savedRequestsStore

- **役割**: 保存済みリクエストとフォルダーの管理
- **状態**: `savedRequests[]`, `savedFolders[]`
- **操作**: CRUD、移動、複製、削除（再帰的）

#### themeStore

- **役割**: アプリケーションテーマの管理
- **状態**: `mode: 'light' | 'dark'`
- **操作**: テーマ切り替え

### 4.2 カスタムフック

#### useRequestEditor

- **役割**: リクエスト編集の統合状態管理
- **管理対象**: メソッド、URL、ヘッダー、ボディ、パラメータ

#### useApiResponseHandler

- **役割**: APIリクエストの実行とレスポンス管理
- **機能**: リクエスト送信、エラーハンドリング、レスポンス時間計測

#### useTabs

- **役割**: タブの作成、切り替え、並び替え管理
- **機能**: マルチタブ対応、ドラッグ&ドロップ

#### useKeyboardShortcuts

- **役割**: グローバルキーボードショートカット
- **対応ショートカット**:
  - `Cmd/Ctrl + S`: 保存
  - `Cmd/Ctrl + Enter`: 送信
  - `Cmd/Ctrl + N`: 新規作成
  - `Cmd/Ctrl + W`: タブを閉じる
  - `Cmd/Ctrl + Alt + →/←`: タブ切り替え

---

## 5. API通信フロー

### 5.1 リクエスト送信フロー

1. **UI操作**: ユーザーがSendボタンをクリックまたはキーボードショートカット実行
2. **データ収集**:
   - `useRequestActions.executeSendRequest()`でリクエストデータを収集
   - ヘッダー、パラメータの有効な項目のみをフィルタリング
   - クエリパラメータをURLに付与
3. **IPC送信**: `api.ts`の`sendApiRequest()`でIPCメッセージを送信
4. **メインプロセス処理**:
   - `main.js`の`send-api-request`ハンドラーが受信
   - Axiosで実際のHTTPリクエストを実行
5. **レスポンス処理**:
   - メインプロセスからIPCでレスポンスを受信
   - `useApiResponseHandler`でレスポンス状態を更新
6. **UI更新**: ResponseDisplayPanelでレスポンス内容を表示

### 5.2 エラーハンドリング

#### ネットワークエラー

- タイムアウト、接続エラーなどのAxiosエラーをキャッチ
- エラー詳細をIPCで安全にシリアライズして送信

#### HTTPエラー

- 2xx以外のステータスコードを適切に処理
- `validateStatus: () => true`でAxiosのデフォルトエラー処理を無効化

#### JSONパースエラー

- リクエストボディのJSONパースエラーを事前チェック
- 不正なJSONの場合はUI側でエラー表示

---

## 6. コンポーネント設計

### 6.1 Atomic Design

#### Atoms（原子）

- **BaseButton**: 基本ボタンコンポーネント
- **TextInput**: テキスト入力フィールド
- **SelectBox**: セレクトボックス
- **Modal**: モーダルダイアログ
- **Toast**: トースト通知

#### Molecules（分子）

- **HeaderRow**: ヘッダー行コンポーネント
- **BodyKeyValueRow**: ボディKey-Value行
- **RequestMethodRow**: HTTPメソッド選択行
- **ErrorAlert**: エラーアラート表示

#### Organisms（有機体）

- **TabBar**: タブバー全体
- **ShortcutsGuide**: ショートカットガイド表示

#### Pages（ページ）

- **RequestCollectionSidebar**: リクエストコレクション管理サイドバー
- **RequestEditorPanel**: リクエスト編集パネル
- **ResponseDisplayPanel**: レスポンス表示パネル

### 6.2 Props設計

#### 型安全性

- TypeScriptインターフェースによる厳密な型定義
- ジェネリクス活用による再利用可能なコンポーネント設計

#### イベントハンドリング

- コールバック関数による親子間の疎結合
- カスタムイベント型の定義による型安全なイベント処理

---

## 7. テスト戦略

### 7.1 テストピラミッド

#### ユニットテスト（Vitest + React Testing Library）

- **対象**: 各コンポーネントの単体機能
- **カバレッジ**: コンポーネントのProps、状態変化、イベント処理
- **モック**: MSW（Mock Service Worker）によるAPI通信モック

#### インテグレーションテスト

- **対象**: コンポーネント間の連携動作
- **カバレッジ**: フック間の状態同期、IPC通信

#### E2Eテスト（Playwright）

- **対象**: エンドユーザーのワークフロー
- **カバレッジ**: リクエスト作成から送信、レスポンス確認までの一連の流れ

### 7.2 ビジュアルテスト（Storybook）

#### コンポーネントカタログ

- **対象**: 各コンポーネントの視覚的確認
- **バリエーション**: Props、状態の組み合わせパターン
- **テーマ対応**: ダーク/ライトモードでの表示確認

---

## 8. 開発・ビルド

### 8.1 開発環境

#### ホットリロード

- **レンダラープロセス**: Vite開発サーバーによる高速リロード
- **メインプロセス**: ファイル変更監視による自動再起動
- **同時起動**: `npm run dev`でElectron + Vite + Storybookを同時起動可能

#### 開発ツール

- **Electron DevTools**: 自動で開発者ツールを起動
- **Storybook**: コンポーネント開発・テスト環境
- **ESLint**: コード品質チェック
- **Prettier**: コードフォーマット

### 8.2 ビルド・パッケージング

#### 本番ビルド

1. **レンダラービルド**: `npm run build:renderer`でReactアプリをビルド
2. **Electronパッケージング**: `npm run build:electron`でOS別実行ファイル生成

#### 出力形式

- **macOS**: `.dmg`形式
- **Windows**: `.exe`形式
- **Linux**: AppImage対応

---

## 9. 設定・カスタマイズ

### 9.1 設定ファイル

#### Electron設定

- **ウィンドウサイズ**: 1920x1080（デフォルト）
- **セキュリティ設定**: IPC通信のため一部制限を緩和

#### Vite設定

- **React Plugin**: `@vitejs/plugin-react`使用
- **開発サーバー**: ポート5173

#### Tailwind設定

- **カスタムカラー**: CSS変数との連携
- **ダークモード**: クラス戦略

### 9.2 環境変数

#### 開発環境判定

- `NODE_ENV=development`: 開発モード
- `NODE_ENV=production`: 本番モード

---

## 10. パフォーマンス

### 10.1 最適化手法

#### React最適化

- **React.memo**: 不要な再レンダリングの防止
- **useCallback/useMemo**: 関数・値のメモ化
- **useState/useRef**: 適切な状態管理手法の選択

#### バンドル最適化

- **Vite**: 高速なHMR（Hot Module Replacement）
- **Tree Shaking**: 未使用コードの自動削除
- **Code Splitting**: 必要に応じた動的インポート

### 10.2 メモリ管理

#### IPC最適化

- **シリアライズ**: エラーオブジェクトの安全なシリアライズ
- **メモリリーク防止**: イベントリスナーの適切なクリーンアップ

---

## 11. セキュリティ

### 11.1 Electronセキュリティ

#### 制限事項

- **contextIsolation**: IPC通信のため無効化
- **webSecurity**: CORS回避のため無効化
- **nodeIntegration**: レンダラープロセスでNode.js API使用

#### リスク軽減

- **主要処理をメインプロセスで実行**: HTTP通信はメインプロセスに委譲
- **入力検証**: APIリクエストデータの事前検証

### 11.2 データ保護

#### ローカルストレージ

- **機密情報**: APIキー等の機密情報は保存しない設計
- **データ暗号化**: 現在は平文保存（将来的に暗号化検討）

---

## 12. 今後の拡張予定

### 12.1 機能拡張

#### 認証機能

- **OAuth 2.0**: OAuth認証フローの対応
- **API Key管理**: 安全なAPIキー保存・管理
- **環境変数**: リクエスト内での変数置換

#### コラボレーション機能

- **チーム共有**: リクエストコレクションの共有
- **エクスポート/インポート**: Postman、Insomnia形式との互換性

### 12.2 技術的改善

#### パフォーマンス向上

- **仮想化**: 大量のリクエスト表示の最適化
- **キャッシュ機能**: レスポンスのローカルキャッシュ

#### UX改善

- **リクエスト履歴**: 送信したリクエストの履歴管理
- **自動補完**: URL、ヘッダーの自動補完機能

---

この仕様書は ReqX-Atelier v1.0.0 の実装状況を基に作成されています。プロジェクトの進化に合わせて随時更新される予定です。
