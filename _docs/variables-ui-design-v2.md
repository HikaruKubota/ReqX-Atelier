# ReqX-Atelier 変数機能 画面設計書 v2.1

## 1. 画面構成概要

### 1.1 主要コンポーネント

```
┌─────────────────────────────────────────────────────────────┐
│ ツールバー                                                    │
│ ┌─────────────────────────────────────┐ ┌─────┐ ┌─────────┐ │
│ │ 🌐 Environment: Development ▼      │ │ {x} │ │ ⚙️      │ │
│ └─────────────────────────────────────┘ └─────┘ └─────────┘ │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  メインコンテンツエリア                                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**コンポーネント説明:**

- **環境セレクター**: 現在の環境を表示・切り替え
- **変数ボタン {x}**: 変数パネルを開く
- **設定ボタン ⚙️**: アプリケーション設定

### 1.2 環境セレクターのドロップダウン

```
┌─────────────────────────────────────┐
│ 🌐 Environment: Development ▼      │
├─────────────────────────────────────┤
│ ✓ Development                       │
│   Staging                          │
│   Production                       │
│ ─────────────────────────────────── │
│ + Add Custom Environment...         │
└─────────────────────────────────────┘
```

## 2. 変数パネル設計

### 2.1 基本レイアウト

```
┌──────────────────────────────────────────────────────────────────┐
│ Variables - Development Environment                        [✕]  │
├──────────────────────────────────────────────────────────────────┤
│ ┌────────────────────────────────────────────────────────────┐  │
│ │ 🔍 Search variables...                                     │  │
│ └────────────────────────────────────────────────────────────┘  │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 🌍 Global Variables (All Environments)                          │
│ ────────────────────────────────────────────────────────────────│
│                                                                  │
│ ┌──────────────┬─────────────────────────────────┬────┬─────┐  │
│ │ Variable     │ Value                           │ On │ ⋮   │  │
│ ├──────────────┼─────────────────────────────────┼────┼─────┤  │
│ │ appName      │ ReqX-Atelier                    │ ✓  │ ⋮   │  │
│ │ apiVersion   │ v1                              │ ✓  │ ⋮   │  │
│ │ defaultTimeout│ 30000                           │ ✓  │ ⋮   │  │
│ │ userAgent    │ ReqX-Atelier/1.0                │ ✓  │ ⋮   │  │
│ └──────────────┴─────────────────────────────────┴────┴─────┘  │
│                                                                  │
│ [+ Add Global Variable]                                          │
│                                                                  │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 🌐 Environment Variables (Development)                          │
│ ────────────────────────────────────────────────────────────────│
│                                                                  │
│ ┌──────────────┬─────────────────────────────────┬────┬─────┐  │
│ │ Variable     │ Value                           │ On │ ⋮   │  │
│ ├──────────────┼─────────────────────────────────┼────┼─────┤  │
│ │ baseUrl      │ https://api-dev.example.com     │ ✓  │ ⋮   │  │
│ │ apiKey       │ dev-key-123                     │ ✓  │ ⋮   │  │
│ │ timeout      │ 5000 ⓘ                         │ ✓  │ ⋮   │  │
│ └──────────────┴─────────────────────────────────┴────┴─────┘  │
│                                                                  │
│ [+ Add Environment Variable]                                     │
│                                                                  │
├──────────────────────────────────────────────────────────────────┤
│ [🔒 Secure Variables] [❓ Help]                                 │
└──────────────────────────────────────────────────────────────────┘
```

**ⓘ マーク**: Global値を上書きしていることを示す

### 2.2 変数行の詳細

#### 通常の変数行

```
┌──────────────┬─────────────────────────────────┬────┬─────┐
│ baseUrl      │ https://api-dev.example.com     │ ✓  │ ⋮   │
└──────────────┴─────────────────────────────────┴────┴─────┘
```

#### セキュア変数行（パスワード等）

```
┌──────────────┬─────────────────────────────────┬────┬─────┐
│ apiSecret 🔒 │ •••••••••••••••                │ ✓  │ ⋮   │
└──────────────┴─────────────────────────────────┴────┴─────┘
```

#### 編集モード

```
┌──────────────┬─────────────────────────────────┬────┬─────┐
│ [baseUrl   ] │ [https://api-dev.example.com  ] │ ✓  │ ⋮   │
└──────────────┴─────────────────────────────────┴────┴─────┘
```

### 2.3 コンテキストメニュー（⋮ ボタン）

```
┌─────────────────┐
│ 編集            │
│ コピー          │
│ ─────────────── │
│ セキュア化 🔒    │
│ ─────────────── │
│ 削除            │
└─────────────────┘
```

## 3. 変数使用時のUI

### 3.1 変数のツールチップ表示

```
マウスホバー時:
${timeout}
    ↓
┌──────────────────────────────────┐
│ timeout: "5000"                  │
│ Scope: 🌐 Environment            │
│ Overrides: Global                │
│ ──────────────────────────────── │
│ Global value: "30000"            │
└──────────────────────────────────┘
```

### 3.2 未定義変数の警告表示

```
┌────────────────────────────────────────────────┐
│ ${undefinedVar}                                │
│    ~~~~~~~~~ （黄色の波線）                     │
└────────────────────────────────────────────────┘
         ↓
┌──────────────────────────────────┐
│ ⚠️ Undefined Variable            │
│ 'undefinedVar' is not defined    │
│ ──────────────────────────────── │
│ 💡 Add to Global Variables       │
│ 💡 Add to Environment Variables  │
└──────────────────────────────────┘
```

## 4. レスポンシブ対応

### 4.1 狭い画面での表示（< 800px）

```
┌────────────────────────┐
│ Variables       [✕]  │
├────────────────────────┤
│ 🔍 Search...          │
├────────────────────────┤
│ 🌍 Global Variables   │
│ ──────────────────────│
│ appName               │
│ ReqX-Atelier      ✓ ⋮ │
│                       │
│ apiVersion            │
│ v1                ✓ ⋮ │
│                       │
│ [+ Add Global]        │
├────────────────────────┤
│ 🌐 Environment        │
│ ──────────────────────│
│ baseUrl               │
│ https://api-d...  ✓ ⋮ │
│                       │
│ [+ Add Environment]   │
└────────────────────────┘
```

## 5. 色の定義

### 5.1 カラーパレット

| 用途                       | 色        | 説明                     |
| -------------------------- | --------- | ------------------------ |
| 背景色（ライトモード）     | `#FFFFFF` | メイン背景               |
| 背景色（ダークモード）     | `#1E1E1E` | メイン背景               |
| テキスト色（ライトモード） | `#333333` | 通常テキスト             |
| テキスト色（ダークモード） | `#E0E0E0` | 通常テキスト             |
| プライマリカラー           | `#0066CC` | ボタン、リンク           |
| 成功色                     | `#28A745` | 有効状態、成功メッセージ |
| 警告色                     | `#FFC107` | 警告、未定義変数         |
| エラー色                   | `#DC3545` | エラー状態               |
| ボーダー色                 | `#E0E0E0` | 区切り線、枠線           |

### 5.2 コントラスト比

- 通常テキスト: 最低 4.5:1
- 大きなテキスト: 最低 3:1
- アイコン・UI要素: 最低 3:1

## 6. エラー状態の表示

### 6.1 変数名の重複エラー

```
┌──────────────┬─────────────────────────────────┬────┬─────┐
│ baseUrl ❌   │ https://api.example.com         │ ✓  │ ⋮   │
└──────────────┴─────────────────────────────────┴────┴─────┘
エラー: This variable name already exists
```

### 6.2 無効な変数名

```
┌──────────────┬─────────────────────────────────┬────┬─────┐
│ 123invalid ❌ │ value                           │ ✓  │ ⋮   │
└──────────────┴─────────────────────────────────┴────┴─────┘
エラー: Variable names must start with a letter
```

## 7. 実装上の注意点

### 7.1 レイアウト幅の確保

変数パネルは1行あたり4つの項目（変数名、値、有効/無効トグル、メニューボタン）を表示するため、十分な横幅が必要です。

**パネル（モーダル）のサイズ:**

- 最小幅: 800px
- 推奨幅: 1000px以上
- 最大幅: 画面幅の90%
- 高さ: 画面高さの80%（最大）

**列幅の配分:**

- 変数名列: 最小200px、推奨250px
- 値列: 残りの幅を動的に割り当て（最小400px）
- トグル列: 60px固定
- メニュー列: 50px固定

**狭い画面での対応:**

- 800px未満の画面では画面幅の95%を使用
- 値が長い場合は省略表示（例: `https://api-dev...`）
- ツールチップで完全な値を表示
