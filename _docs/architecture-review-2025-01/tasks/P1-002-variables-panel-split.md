# P1-002: VariablesPanel分割

## 概要

514行のVariablesPanel.tsxを機能単位に分割し、保守性とテスタビリティを向上させる。

## 現状の問題点

- 変数の表示、編集、検証が一つのコンポーネントに混在
- テストが困難（UIとロジックが密結合）
- 変数の追加・編集時に全体が再レンダリング
- コンポーネントの責務が不明確

## 実装計画

### Step 1: コンポーネント構造の設計

```
src/renderer/src/components/organisms/VariablesPanel/
├── index.tsx              # メインコンテナ
├── VariablesList.tsx      # 変数リスト表示
├── VariableRow.tsx        # 個別変数行
├── VariableForm.tsx       # 変数編集フォーム
├── EnvironmentSelector.tsx # 環境選択
├── hooks/
│   ├── useVariables.ts    # 変数管理ロジック
│   └── useVariableValidation.ts
└── __tests__/
```

### Step 2: ビジネスロジックの抽出

1. useVariables.tsの実装

   - 変数のCRUD操作
   - 環境切り替えロジック
   - 変数の解決処理

2. useVariableValidation.tsの実装
   - 変数名の重複チェック
   - 値の妥当性検証
   - エラーメッセージ管理

### Step 3: VariableRow.tsxの実装

1. 個別の変数表示コンポーネント
2. インライン編集機能
3. 削除確認ダイアログ
4. React.memoによる最適化

### Step 4: VariableForm.tsxの実装

1. 新規作成・編集フォーム
2. バリデーション表示
3. キーボードショートカット対応
4. フォーカス管理

### Step 5: VariablesList.tsxの実装

1. 変数リストの仮想化（大量データ対応）
2. フィルタリング・検索機能
3. ソート機能
4. 一括操作

### Step 6: 統合とテスト

1. 既存の機能を維持しながら段階的に移行
2. 各コンポーネントの単体テスト
3. 統合テストの実装
4. パフォーマンステスト

## 完了条件

- [ ] 各コンポーネントが150行以下
- [ ] コンポーネントごとに単体テスト実装
- [ ] 変数操作のレスポンス時間が50%改善
- [ ] テストカバレッジ85%以上
- [ ] npm run all が全てパス

## 見積もり工数

3日（フルタイム換算）

## 依存関係

- P1-001（選択的サブスクリプション）の完了が望ましい

## リスクと対策

- **リスク**: 状態管理の複雑化
  - **対策**: 明確な状態フローの設計とドキュメント化
- **リスク**: 既存機能の破壊
  - **対策**: Feature Flagによる段階的リリース
