# P2-002: テストカバレッジ改善

## 概要

現在77%のテストカバレッジを85%以上に向上させ、特に複雑なフックとコンポーネントのテストを充実させる。

## 現状の問題点

- 複雑なフック（useApiResponseHandler等）のカバレッジが14-28%
- E2Eテストが0
- 統合テストが不足
- エッジケースのテストが不十分

## 実装計画

### Step 1: 低カバレッジ領域の特定

1. カバレッジレポートの詳細分析

```bash
npm run test:coverage
```

2. 優先順位付け
   - ビジネスクリティカルな機能
   - 複雑なロジック
   - バグが発生しやすい箇所

### Step 2: フックのテスト強化

1. useApiResponseHandler.test.ts

   - 成功・エラーケース
   - タイムアウト処理
   - キャンセル処理

2. useRequestExecution.test.ts

   - 変数展開のテスト
   - ヘッダー処理
   - リトライロジック

3. useShortcuts.test.ts
   - キーボードイベントのシミュレーション
   - 複数キーの組み合わせ

### Step 3: 複雑なコンポーネントのテスト

1. RequestCollectionTree.test.tsx

   - ドラッグ&ドロップ
   - フォルダ展開・折りたたみ
   - 右クリックメニュー

2. ResponseDisplayPanel.test.tsx
   - 各種レスポンス形式の表示
   - エラー表示
   - 大容量データの処理

### Step 4: 統合テストの追加

1. API通信フローの統合テスト
2. 状態管理の統合テスト
3. ナビゲーションフロー

### Step 5: テストユーティリティの整備

1. テストヘルパー関数の作成
2. カスタムレンダラーの実装
3. モックデータファクトリー

### Step 6: CI/CDでの品質ゲート

1. カバレッジ閾値の設定
2. PR時の自動チェック
3. カバレッジレポートの可視化

## 完了条件

- [ ] 全体のテストカバレッジ85%以上
- [ ] 各フックのカバレッジ80%以上
- [ ] 主要コンポーネントのカバレッジ90%以上
- [ ] CI/CDでカバレッジチェック自動化
- [ ] テストが3分以内に完了

## 見積もり工数

5日（フルタイム換算）

## 依存関係

- P0-001, P0-003の完了後（リファクタリング後のテスト）

## リスクと対策

- **リスク**: テストの実行時間増加
  - **対策**: 並列実行とテストの最適化
- **リスク**: 脆いテストの増加
  - **対策**: Testing Libraryのベストプラクティス適用
