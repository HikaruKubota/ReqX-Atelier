# フォルダ機能 仕様書 (v0.5)

## 1. 基本要件
| 機能 | 詳細 |
|---|---|
| **フォルダ作成ボタン** | サイドバー上部に常設（＋アイコン）。クリックで「新規フォルダ」を生成。 |
| **コンテキストメニュー** | フォルダを右クリック → 小型メニュー表示（既存リクエストの右クリックメニューを流用）。<br>メニュー項目: <br>&nbsp;&nbsp;• 新規フォルダを作成<br>&nbsp;&nbsp;• 新規リクエストを作成<br>&nbsp;&nbsp;• フォルダの名前を変更<br>&nbsp;&nbsp;• フォルダを削除 |
| **トグル表示** | フォルダクリックで配下リクエスト一覧を展開／折りたたみ。インジケータ（▶ / ▼）付き。 |
| **並び順** | 同一階層内で「フォルダ → リクエスト」の順、かつ名前昇順（大文字小文字を区別しない、Unicode 正規化）。 |
| **削除時の挙動** | フォルダ削除は **再帰的削除**（配下のサブフォルダ・リクエストも全削除）。確認ダイアログ必須。Undo は 1 ステップ分サポート。 |
| **サブフォルダ深さ** | **無制限**（階層制限なし）。 |
| **アクセシビリティ & キーボード操作** | **ARIA TreeView 準拠**。キーボード操作必須：↑ / ↓ / ← / → / Enter でフォーカス移動・展開／折りたたみ・選択が可能。 |

---

## 2. ドラッグ＆ドロップ (DnD) 詳細仕様

| 項目 | 仕様 |
|---|---|
| **ライブラリ** | [`react-arborist`](https://github.com/brimdata/react-arborist) （組み込み DnD + 仮想リスト + ツリーモデル） |
| **ドラッグ可能要素** | フォルダ・リクエストの両方 <br>— ただし **ドロップ受け入れ先はフォルダのみ** |
| **禁止ルール** | - フォルダを自身またはその子孫へドロップ不可<br>- リクエストをリクエストへドロップ不可 |
| **順序変更** | 同一フォルダ内で上下並び替えは標準ドラッグ操作で対応（`onMove` が移動結果を返す） |
| **入れ子変更** | ドロップ位置がフォルダのヘッダ上の場合、そのフォルダ配下に移動。<br>階層は無制限だが禁止ルールの循環チェックを行う。 |
| **自動展開** | ドラッグオーバー中に 500 ms ホバーでフォルダを自動展開 (`setTimeout`) |
| **ビジュアルフィードバック** | - ドラッグ中のアイテムは `opacity: 0.7` + 軽い `box-shadow`<br>- ドロップターゲットは `outline: 2px dashed`<br>- 挿入位置は 2 px ラインインジケータ |
| **オートスクロール** | react-arborist 標準の auto‑scroll 機能を使用（追加実装不要） |
| **アニメーション** | react‑arborist の既定（react‑spring, 120 ms ease‑out） |
| **パフォーマンス** | 仮想リスト機能が標準搭載。要素数 5,000+ でも安定。 |
| **アクセシビリティ** | キーボード DnD は **非対応**。マウス／タッチ操作のみ。 |

---

## 3. 補足
- **永続化方式** は既定のストレージ戦略に従う（詳細割愛）。
- 大量データバーチャライズは scope 外。必要になれば別途検討。
- 保存済みリストのStyleもTreeの表示に合わせて修正する。

---

*最終確認後、実装フェーズへ進んでください。*
